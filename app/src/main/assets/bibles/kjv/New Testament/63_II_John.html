<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset='UTF-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0'>
<title>II John</title>
<link rel='stylesheet' href='../../style.css'>
<style>
body, p { margin: 0; padding: 0; line-height: 1.2; }
#sticky-title { position: sticky; top: 0; background-color: white; z-index:ible files1000; padding: 10px; border-bottom: 2px solid #ccc; font-size: 1.5em; text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px; }
button { width: 40px; height: 40px; font-size: 20px; border: none; background-color: #007BFF; color: white; border-radius: 5px; }
input { width: 60px; text-align: center; font-size: 20px; border: 1px solid #ccc; border-radius: 5px; -moz-appearance: textfield; }
input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
</style>
</head>
<body>
<script>const bookId = '63';</script>
<script>const version = 'kjv';</script>
<div id='sticky-title'><a href='/close' style='color: blue; text-decoration: none;'>&#8617;</a><span id='sticky-title-book'>II John</span><button id='prevChapter'>-</button><input id='chapterInput' type='number' value='1' min='1' max='1'><button id='nextChapter'>+</button><span style='flex-grow: 1;'>&nbsp;</span><a href='/exit' style='color: red; text-decoration: none;'>x</a></div>
<a href='./62_I_John.html'>Prev: I John</a><br>
<a href='./64_III_John.html'>Next: III John</a>
<h1>II John</h1>
<h2 id='chapter_1'>Chapter 1</h2>
<p id='63_01:001' data-selected='false'><strong>1.</strong> The elder unto the elect lady and her children, whom I love in the truth; and not I only, but also all they that have known the truth;</p>
<p id='63_01:002' data-selected='false'><strong>2.</strong> For the truthâ€™s sake, which dwelleth in us, and shall be with us for ever.</p>
<p id='63_01:003' data-selected='false'><strong>3.</strong> Grace be with you, mercy, and peace, from God the Father, and from the Lord Jesus Christ, the Son of the Father, in truth and love.</p>
<p id='63_01:004' data-selected='false'><strong>4.</strong> I rejoiced greatly that I found of thy children walking in truth, as we have received a commandment from the Father.</p>
<p id='63_01:005' data-selected='false'><strong>5.</strong> And now I beseech thee, lady, not as though I wrote a new commandment unto thee, but that which we had from the beginning, that we love one another.</p>
<p id='63_01:006' data-selected='false'><strong>6.</strong> And this is love, that we walk after his commandments. This is the commandment, That, as ye have heard from the beginning, ye should walk in it.</p>
<p id='63_01:007' data-selected='false'><strong>7.</strong> For many deceivers are entered into the world, who confess not that Jesus Christ is come in the flesh. This is a deceiver and an antichrist.</p>
<p id='63_01:008' data-selected='false'><strong>8.</strong> Look to yourselves, that we lose not those things which we have wrought, but that we receive a full reward.</p>
<p id='63_01:009' data-selected='false'><strong>9.</strong> Whosoever transgresseth, and abideth not in the doctrine of Christ, hath not God. He that abideth in the doctrine of Christ, he hath both the Father and the Son.</p>
<p id='63_01:010' data-selected='false'><strong>10.</strong> If there come any unto you, and bring not this doctrine, receive him not into your house, neither bid him God speed:</p>
<p id='63_01:011' data-selected='false'><strong>11.</strong> For he that biddeth him God speed is partaker of his evil deeds.</p>
<p id='63_01:012' data-selected='false'><strong>12.</strong> Having many things to write unto you, I would not write with paper and ink: but I trust to come unto you, and speak face to face, that our joy may be full.</p>
<p id='63_01:013' data-selected='false'><strong>13.</strong> The children of thy elect sister greet thee. Amen.</p>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const stickyTitle = document.getElementById('sticky-title');
    const chapters = document.querySelectorAll('h2');
    const chapterInput = document.getElementById('chapterInput');
    const prevChapterButton = document.getElementById('prevChapter');
    const nextChapterButton = document.getElementById('nextChapter');
    const totalChapters = chapters.length;
    let currentChapterNum = 1;
    let lastSentChapter = '';
    window.addEventListener('scroll', () => {
        chapters.forEach((chapter, index) => {
            const rect = chapter.getBoundingClientRect();
            if (rect.top <= window.innerHeight / 2 && rect.bottom > 0) {
                currentChapterNum = index + 1;
            }
        });
        if (parseInt(chapterInput.value) !== currentChapterNum) {
            chapterInput.value = currentChapterNum;
        }
        const payload = `${bookId}_${currentChapterNum.toString().padStart(2, '0')}:001`;
        if (lastSentChapter !== payload) {
            lastSentChapter = payload;
            fetch('/mark', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ payload: payload, version: version })
            });
        }
    });
    const scrollToChapter = (chapterNum) => {
        const targetChapter = chapters[chapterNum - 1];
        if (targetChapter) {
            const headerOffset = 90;
            const elementPosition = targetChapter.getBoundingClientRect().top + window.scrollY;
            const offsetPosition = elementPosition - headerOffset;
            window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
        }
    };
    prevChapterButton.addEventListener('click', () => {
        let value = parseInt(chapterInput.value) || 1;
        if (value > 1) {
            value--;
            currentChapterNum = value;
            chapterInput.value = value;
            scrollToChapter(value);
        }
    });
    nextChapterButton.addEventListener('click', () => {
        let value = parseInt(chapterInput.value) || 1;
        if (value < totalChapters) {
            value++;
            currentChapterNum = value;
            chapterInput.value = value;
            scrollToChapter(value);
        }
    });
    chapterInput.addEventListener('change', () => {
        let value = parseInt(chapterInput.value) || 1;
        if (value >= 1 && value <= totalChapters) {
            currentChapterNum = value;
            scrollToChapter(value);
        } else {
            chapterInput.value = currentChapterNum;
        }
    });
    chapterInput.addEventListener('click', (event) => {
        event.target.select();
    });
    window.addEventListener('DOMContentLoaded', () => {
        const targetId = window.location.hash.substring(1); // Extract the fragment ID
        if (targetId) {
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
                // Prevent default browser hash scroll behavior
                setTimeout(() => {
                    const headerOffset = 90; // Adjust for sticky header
                    const elementPosition = targetElement.getBoundingClientRect().top + window.scrollY;
                    const offsetPosition = elementPosition - headerOffset;
                    window.scrollTo({ top: offsetPosition }); // Immediate scroll
                    targetElement.style.backgroundColor = '#ffff99'; // Apply highlight color
                    targetElement.style.transition = 'background-color 1s';
                    setTimeout(() => {
                        targetElement.style.backgroundColor = 'transparent'; // Fade out highlight
                    }, 3000); // Highlight fades after 3 seconds
                }, 50); // Short delay to ensure hash handling completes
            }
        }
    });
});
    const verses = document.querySelectorAll('p[data-selected]');
    verses.forEach(verse => {
        verse.addEventListener('click', (event) => {
            if (event.target.tagName === 'STRONG') {
                const isSelected = verse.getAttribute('data-selected') === 'true';
                verse.setAttribute('data-selected', isSelected ? 'false' : 'true');
                verse.style.backgroundColor = isSelected ? 'transparent' : '#D3F9D8';
            }
        });
    });
    const exitButton = document.querySelector('a[href="/exit"]');
    exitButton.addEventListener('click', (event) => {
        event.preventDefault(); // Prevent default navigation

        // Collect all selected verse IDs
        const selectedVerses = [];
        document.querySelectorAll('p[data-selected="true"]').forEach(verse => {
            selectedVerses.push(verse.id); // Collect the verse ID
        });

        // If no verses are selected, do nothing
        if (selectedVerses.length === 0) {
            console.log('No verses selected. Exiting without action.');
            return;
        }

        // Build and send the payload
        fetch('/exit', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ selectedVerses: selectedVerses, version: version })
        })
        .then(response => {
            if (response.ok) {
                console.log('Selected verses sent successfully.');
            } else {
                console.error('Failed to send selected verses.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });
</script>
</body>
</html>
